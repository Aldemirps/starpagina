<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <title>Player Premium v2 – Tela Cheia</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
  <meta name="theme-color" content="#0f172a">

  <!-- PWA -->
  <link rel="manifest" href="/manifest.json">

  <!-- iOS -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Player v2">
  <link rel="apple-touch-icon" href="/icon-192.png">

  <!-- Video.js -->
  <link href="https://vjs.zencdn.net/8.10.0/video-js.css" rel="stylesheet">
  <script src="https://vjs.zencdn.net/8.10.0/video.js"></script>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- (todo o CSS que você já possui) -->
  <style>
    :root{--primary:109 40 217;--secondary:139 92 246;--accent:245 158 11;--surface:15 23 42 / 0.55;--glass:rgba(255,255,255,.08)}
    *{box-sizing:border-box;font-family:Inter,system-ui,-apple-system,sans-serif}
    html,body{height:100%;margin:0;background:#0f172a;color:#f8fafc;overflow:hidden}
    .panel{background:var(--glass);-webkit-backdrop-filter:blur(14px) saturate(180%);backdrop-filter:blur(14px) saturate(180%);border:1px solid rgba(255,255,255,.06);border-radius:20px;box-shadow:0 8px 20px rgba(0,0,0,.35)}
    .glow{transition:all .4s ease}
    .glow:hover{box-shadow:0 0 20px 2px rgba(var(--accent),.55);transform:translateY(-2px)}
    .channel-list-container{position:absolute;top:20px;right:20px;width:320px;max-height:80vh;z-index:1000;transform:translateX(0);opacity:1;transition:all .5s cubic-bezier(.4,0,.2,1)}
    .channel-list-container.hidden{transform:translateX(120%);opacity:0;pointer-events:none}
    .channel-list::-webkit-scrollbar{width:6px}
    .channel-list::-webkit-scrollbar-thumb{background:rgba(var(--primary),.9);border-radius:3px}
    .channel-list::-webkit-scrollbar-track{background:transparent}
    .channel-item{border-left:3px solid transparent;transition:all .25s ease;cursor:pointer}
    .channel-item:hover{background:rgba(var(--primary),.15);transform:translateX(4px)}
    .channel-item.active{background:linear-gradient(90deg,rgba(var(--accent),.25),transparent);border-left-color:rgb(var(--accent))}
    .toggle-channels-btn{position:absolute;top:20px;right:20px;z-index:1001;background:rgba(15,23,42,.65);-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px);border:1px solid rgba(255,255,255,.12);border-radius:50%;width:44px;height:44px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:20px;transition:all .3s;opacity:1}
    .toggle-channels-btn.hidden{opacity:0;pointer-events:none}
    .toggle-channels-btn:hover{background:rgb(var(--accent));transform:scale(1.15) rotate(90deg)}
    .video-js{width:100%!important;height:100%!important;border-radius:0;cursor:none}
    .video-js .vjs-big-play-button{background:rgb(var(--primary));border:none;border-radius:50%;width:74px;height:74px;line-height:74px;top:50%;left:50%;transform:translate(-50%,-50%);transition:.3s}
    .video-js .vjs-big-play-button:hover{background:rgb(var(--secondary));transform:translate(-50%,-50%) scale(1.12)}
    .video-js .vjs-control-bar{background:linear-gradient(to top,rgba(0,0,0,.8),transparent);height:3.4em}
    .video-js .vjs-play-progress{background:rgb(var(--accent))}
    .video-js .vjs-loading-spinner{border:5px solid rgba(255,255,255,.3);border-top-color:rgb(var(--accent))}
    @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:none}}
    .fade-in{animation:fadeIn .6s ease forwards}
    .search-input{background:rgba(255,255,255,.08);transition:all .3s}
    .search-input:focus{outline:none;background:rgba(255,255,255,.15);box-shadow:0 0 0 2px rgb(var(--accent))}
    .channel-item:focus{outline:2px solid rgb(var(--accent));outline-offset:-2px}
    @media (max-width:767px){.channel-list-container{width:90%;right:5%;left:5%}.toggle-channels-btn{top:10px;right:10px}}
    .click-overlay{position:absolute;top:0;left:0;width:100%;height:100%;z-index:999;cursor:none}
  </style>
</head>

<body class="h-full">
  <div id="player-container" class="w-full h-full relative">
    <button id="toggle-channels-btn" class="toggle-channels-btn" aria-label="Alternar lista de canais">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
      </svg>
    </button>

    <div id="click-overlay" class="click-overlay"></div>

    <video id="video-player" class="video-js vjs-default-skin" controls autoplay preload="auto" playsinline>
      <source src="" type="application/x-mpegURL">
    </video>
  </div>

  <div id="channel-list-container" class="panel channel-list-container hidden">
    <div class="p-4 border-b border-white/10">
      <h2 class="text-xl font-bold flex items-center mb-3">
        <svg class="h-6 w-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
        </svg>
        Lista de Canais
      </h2>
      <div class="relative">
        <input id="search-input" type="text" placeholder="Buscar canal..." class="search-input w-full rounded-lg py-2 px-3 text-sm placeholder-slate-300">
        <svg class="h-4 w-4 absolute right-3 top-2.5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
        </svg>
      </div>
    </div>

    <ul id="channel-list" class="channel-list space-y-1 p-3 overflow-y-auto max-h-[60vh]"></ul>
  </div>

  <!-- JS principal -->
  <script>
    const player = videojs('video-player', {
      responsive:true, fluid:true,
      html5:{vhs:{limitRenditionByPlayerDimensions:false, useDevicePixelRatio:true, smoothQualityChange:true, maxBufferLength:120, maxMaxBufferLength:600, maxBufferSize:60*1000*1000, maxBufferAhead:300}},
      controlBar:{pictureInPictureToggle:false, fullscreenToggle:true, volumePanel:{inline:false}},
      userActions:{
        hotkeys:function(e){
          if(e.key===' '){e.preventDefault();player.paused()?player.play():player.pause()}
          else if(e.key==='ArrowUp'){e.preventDefault();player.volume(Math.min(1,player.volume()+.1))}
          else if(e.key==='ArrowDown'){e.preventDefault();player.volume(Math.max(0,player.volume()-.1))}
          else if(e.key.toLowerCase()==='l')toggleChannelsList()
        }
      }
    });

    let channelsVisible=false, toggleButtonVisible=true, hideControlsTimeout;
    const container=document.getElementById('channel-list-container'), toggleBtn=document.getElementById('toggle-channels-btn'), clickOverlay=document.getElementById('click-overlay'), playerContainer=document.getElementById('player-container');

    function showControls(){toggleBtn.classList.remove('hidden'); toggleButtonVisible=true; clearTimeout(hideControlsTimeout); hideControlsTimeout=setTimeout(hideControls,3000)}
    function hideControls(){if(!channelsVisible){toggleBtn.classList.add('hidden'); toggleButtonVisible=false}}
    function toggleChannelsList(){channelsVisible=!channelsVisible; container.classList.toggle('hidden',!channelsVisible); toggleBtn.innerHTML=channelsVisible?`<svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>`:`<svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>`; showControls()}

    toggleBtn.addEventListener('click',toggleChannelsList);
    clickOverlay.addEventListener('click',showControls);
    playerContainer.addEventListener('mousemove',showControls);
    playerContainer.addEventListener('touchstart',showControls);
    player.on('useractive',showControls);

    player.ready(()=>{setTimeout(()=>{if(!player.isFullscreen())player.requestFullscreen()},1000); hideControlsTimeout=setTimeout(hideControls,3000)});

    player.ready(()=>{const ql=player.qualityLevels(); ql.on('addqualitylevel',()=>{const top=ql.levels_.reduce((max,l)=>l.height>max.height?l:max,{height:0}); if(top.height)ql.levels_.forEach(l=>l.enabled=l.height===top.height)})});

    document.getElementById('search-input').addEventListener('input',e=>{const term=e.target.value.toLowerCase(); document.querySelectorAll('#channel-list li').forEach(li=>li.style.display=li.textContent.toLowerCase().includes(term)?'flex':'none')});

    document.addEventListener('keydown',e=>{if(e.key==='Escape'){if(channelsVisible)toggleChannelsList(); else if(player.isFullscreen())player.exitFullscreen()}});

    let currentChannelIndex=0, channelsList=[];

    document.addEventListener('keydown',e=>{
      if(channelsVisible){
        const items=document.querySelectorAll('#channel-list li:not([style*="display: none"])');
        if(e.key==='ArrowDown'){e.preventDefault(); currentChannelIndex=(currentChannelIndex+1)%items.length; items[currentChannelIndex].focus()}
        else if(e.key==='ArrowUp'){e.preventDefault(); currentChannelIndex=(currentChannelIndex-1+items.length)%items.length; items[currentChannelIndex].focus()}
        else if(e.key==='Enter'&&document.activeElement.classList.contains('channel-item'))document.activeElement.click()
      }
      if(e.key>='0'&&e.key<='9'){
        const n=parseInt(e.key); if(n>0&&n<=channelsList.length){playChannel(channelsList[n-1]); document.querySelectorAll('#channel-list li').forEach(l=>l.classList.remove('active')); document.querySelectorAll('#channel-list li')[n-1].classList.add('active')}
      }
    });

    async function loadPlaylist(){
      try{
        const res=await fetch('https://raw.githubusercontent.com/Aldemirps/Mybox/refs/heads/main/boxlive.m3u');
        if(!res.ok)throw new Error('Falha ao carregar playlist');
        const text=await res.text();
        channelsList=parseM3U(text);
        displayChannels(channelsList);
      }catch(err){
        console.error(err);
        document.getElementById('channel-list').innerHTML=`<li class="p-3 text-rose-300 rounded-lg text-sm"><svg class="h-5 w-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>Falha ao carregar a lista de canais</li>`;
      }
    }

    function parseM3U(text){
      const lines=text.trim().split('\n'), channels=[];
      let current=null;
      for(const line of lines){
        if(line.startsWith('#EXTINF')){
          const name=line.match(/,(.+)/)?.[1]||line.match(/tvg-name="([^"]+)"/)?.[1]||'Canal Desconhecido';
          const logo=line.match(/tvg-logo="([^"]+)"/)?.[1]||null;
          const group=line.match(/group-title="([^"]+)"/)?.[1]||null;
          current={name,logo,group};
        }else if(line.startsWith('http')&&current){
          let url=line.trim();
          if(url.includes('/pandoscanew/'))url=url.replace('/pandoscanew/','/live/pandoscanew/');
          if(url.endsWith('.ts'))url=url.replace('.ts','.m3u8'); else url+='.m3u8';
          current.url=url;
          channels.push(current);
          current=null;
        }
      }
      return channels.map((c,i)=>({...c,number:i+1}));
    }

    function displayChannels(channels){
      const ul=document.getElementById('channel-list');
      ul.innerHTML='';
      channels.forEach((ch,i)=>{
        const li=document.createElement('li');
        li.className='channel-item p-2 rounded-lg flex items-center fade-in';
        li.tabIndex=0;
        li.innerHTML=`
          ${ch.logo?`<img src="${ch.logo}" class="w-8 h-8 mr-3 rounded-full object-cover glow">`
            :`<div class="w-8 h-8 mr-3 rounded-full bg-slate-700 flex items-center justify-center glow"><svg class="h-5 w-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg></div>`}
          <div class="flex-1 truncate"><div class="channel-name font-medium text-sm">${ch.name}</div>${ch.group?`<div class="text-xs text-slate-400 truncate">${ch.group}</div>`:''}</div>
          <div class="ml-2 text-xs font-bold bg-indigo-600/70 rounded-md px-2 py-1">${ch.number}</div>`;
        li.addEventListener('click',()=>{playChannel(ch); document.querySelectorAll('#channel-list li').forEach(l=>l.classList.remove('active')); li.classList.add('active'); toggleChannelsList(); setTimeout(hideControls,500)});
        ul.appendChild(li);
      });
      if(channels.length){playChannel(channels[0]); ul.children[0].classList.add('active')}
    }

    function playChannel(channel){
      player.src({src:channel.url,type:'application/x-mpegURL'});
      player.play().catch(err=>{console.error(err); alert(`Não foi possível reproduzir: ${channel.name}`)});
      document.title=`${channel.number}. ${channel.name} - Player Premium v2`;
    }

    // Registra o SW
    if('serviceWorker' in navigator){window.addEventListener('load',()=>navigator.serviceWorker.register('/sw.js'))}

    // Carrega a lista
    window.addEventListener('load',()=>loadPlaylist());
  </script>
</body>
</html>
